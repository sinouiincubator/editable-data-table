---
name: 可编辑表格
---

import { useState, useCallback, useMemo } from 'react';
import { Playground, Props } from 'docz';
import { ThemeProvider } from 'sinoui-components/styles';
import defaultTheme from 'sinoui-components/styles/defaultTheme';
import TableColumn from '../src/TableColumn';
import EditableDataTable from '../src/EditableDataTable';
import Button from 'sinoui-components/Button';
import TextInput from 'sinoui-components/TextInput';
import produce from 'immer';

# 可编辑表格

## 基本用法

<Playground>
  {() => {
    const validate = (data) => {
      const result = {};
      if (!data.id) {
        result.id = '必填';
      }
      if (data.title && data.title.startsWith('1')) {
        result.title = '标题不能以1开头';
      }
      return result;
    };

    const [editingRows, setEditingRows] = useState([true,false]);
    const [items, setItems] = useState([{ id: '1', title: '123' }, { id: '2', title: '1234' }]);

    const handleSave = (row, index, context) => {
      if (!context.validate()) {
        alert('数据填写不完整');
      } else {
        setEditingRows(produce(editingRows,(draft)=>{
          draft[index] = !draft[index]
        }));
        alert('保存成功');
      }
    };

    const handleEdit = (index) => {
      setEditingRows(produce(editingRows,(draft)=>{
          draft[index] = !draft[index]
        }));
    };

    return (<EditableDataTable
      data={items}
      editingRows={editingRows}
      validate={validate}
    >
      <TableColumn title="序号" order />
      <TableColumn title="id" name="id" editor={TextInput} />
      <TableColumn title="标题" name="title" editor={TextInput} />
      <TableColumn
        title="操作"
        name="id"
        render={(value, row, index, id, context) => (
          context.editing ?
            <Button onClick={() => handleSave(row, index, context)}>保存</Button> :
            <Button onClick={() => handleEdit(index)}>编辑</Button>
        )}
      />
    </EditableDataTable>);

}}

</Playground>

### 优化版本

<Playground>
  {() => {
    const [data, setData] = useState([
      { id: '1', title: '123' },
      { id: '2', title: '1234' },
    ]);
    const handleAdd = () => {
      setData([
        ...data,
        { id: data.length + 1, title: `标题${data.length + 1}` },
      ]);
    };

    const handleRemove = useCallback((index) => {
      setData(prev => prev.filter((_item, i) => i !== index));
    }, []);

    const renderButtons = useCallback((id, row, index) => (
      <Button onClick={() => handleRemove(index)}>删除</Button>
    ), [handleRemove]);

    const columns = useMemo(() => <>
      <TableColumn title="id" name="id" />
      <TableColumn title="标题" name="title" />
      <TableColumn title="操作列" name="id" />
      <TableColumn title="操作" name="id" render={renderButtons} />
    </>, [handleRemove]);

    return (
        <div>
          <Button onClick={handleAdd}>添加</Button>
          <EditableDataTable data={data}>
          {columns}
          </EditableDataTable>
        </div>
    );

}}

</Playground>

### 无数据

<Playground>
  <EditableDataTable data={[]}>
    <TableColumn title="id" name="id" />
    <TableColumn title="标题" name="title" />
  </EditableDataTable>
</Playground>

## 组件属性

### EditableDataTable

<Props of={EditableDataTable} />

### TableColumn

<Props of={TableColumn} />
