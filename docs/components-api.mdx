---
name: 组件API
route: /components-api
---

import { Playground, Props } from 'docz';
import TableColumn from '../src/TableColumn';
import EditableDataTable from '../src/EditableDataTable';

# 组件 API

包括两个核心的组件和一个自定义 hook：

- EditableDataTable - 可编辑数据表格组件
- TableColumn - 定义数据表格列的组件
- useEditingList - 可编辑表格数据的状态管理 hook（与后端 API 交互，不包括校验状态）
- useSimpleEditingList - 可编辑表格数据的状态管理 hook （不与后端交互，但包括校验状态）

## EditableDataTable

<Props of={EditableDataTable} />

## TableColumn

<Props of={TableColumn} />

## useEditingList

### 参数配置

- `url(string)` - crud 操作时的 url
- `defaultValue(T[])` - 指定默认列表数据，默认值为`[]`
- `options` - 相关配置,主要有 idPropertyName（数据的 id 属性名。默认为`id`）

### 返回值的数据结构

- `items(T[])` - 列表数据
- `editingRows(boolean[])` - 处于编辑状态的行。`editingRows`数组需要与`data`数组保持一一对应的关系，`editingRows`数组中每一个数据项代表的是`data`数组中对应数据项的编辑状态，`true`表示编辑状态，`false`表示非编辑状态。
- `add(()=>void)` - 新增一条可编辑的空数据
- `remove((index:number)=>void)` - 删除一条数据
- `edit((index)=>void)` - 更新一条数据的编辑状态
- `save((row:T,index:number)=>void)` - 新增一条数据或者更新一条数据
- `idPropertyName(string)` - 数据的 id 属性名。默认为`id`

## useSimpleEditingList

可编辑表格数据的状态管理 hook （不与后端交互，但包括校验状态）。

示例：

```tsx
import { useSimpleEditingList } from '@sinouiincubator/editable-data-table';

function Demo() {
  const editingList = useSimpleEditingList(defaultValue, options);
  return null;
}
```

### 参数说明

- `defaultValue` - 指定默认值，默认为`[]`。
- `options` - 指定配置：
  - `alwaysEditing?: boolean` - 如果为`true`，则表示所有数据行处于编辑状态。默认为`false`。
  - `validate?: (item: T) => ErrorResult | undefined` - 验证行数据的函数

### 返回值`editingList`

`editingList`对象有以下属性：

```ts
interface SimpleEditingListResult<T> {
  /**
   * 列表数据
   */
  items: T[];
  /**
   * 设置列表数据
   *
   * @param newItems 新的列表数据
   */
  setItems(newItems: T[]): void;
  /**
   * 数据行的编辑状态。
   */
  editingRows: boolean[];
  /**
   * 设置数据行处于编辑状态
   *
   * @param rowIndex 数据行所在的索引位置
   */
  edit(rowIndex: number): void;
  /**
   * 设置数据行处于只读状态
   *
   * @param rowIndex 数据行所在的索引位置
   */
  setReadonly(rowIndex: number): void;
  /**
   * 添加数据行
   *
   * @param item 需要添加的数据行
   */
  add(item: T): void;
  /**
   * 删除数据行
   *
   * @param index 数据行所在的索引位置
   */
  remove(index: number): void;
  /**
   * 删除一组数据行
   *
   * @param indexes 一组数据行所在的索引位置
   */
  removeItems(indexes: number[]): void;
  /**
   * 更新数据行
   *
   * @param index 数据行所在的索引位置
   * @param item 新的数据对象
   */
  updateItem(index: number, item: T): void;
  /**
   * 错误状态
   */
  errors: ErrorResult[];
  /**
   * 编辑器被点击状态
   */
  touched: TouchedState[];
  /**
   * 校验单个数据项
   *
   * @param index 数据行所在的索引位置
   * @param fieldName 数据项名称
   * @param rowData 数据行的新数据对象
   */
  validateField(index: number, fieldName: string, rowData: T): void;
  /**
   * 校验所有编辑中的数据行
   */
  validateAllEditingRows(): boolean;
}

interface ErrorResult {
  [fieldName: string]: string;
}

interface TouchedState {
  [fieldName: string]: boolean;
}
```
